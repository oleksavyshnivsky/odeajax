/**
 * @file AJAX requests
 * @copyleft Oleksa Vyshnivsky <dying.escape@gmail.com> 2022
 * @license The MIT License (MIT)
 * @version 1.0.4
 * */
var loadJS=function(e,t,a){var r=document.createElement("script");r.src=e,r.onload=t,r.onreadystatechange=t,a.appendChild(r)};const MAIN=document.querySelector("#main")||document.querySelector("main")||document.querySelector("body"),ODEAJAX={performing:!1,baseoptions:{append:!1,before:!1,callback:!1,confirm:!1,data:!1,history:!1,method:"GET",prepend:!1,scroll:MAIN,target:MAIN,timeout:3e4},readOptions:e=>{var t={},a=(t.append=e.hasAttribute("data-oa-append"),t.prepend=e.hasAttribute("data-oa-prepend"),t.before=e.dataset.oaBefore,t.callback=e.dataset.oaCallback,t.confirm=e.dataset.oaConfirm,e.dataset.oaTarget?e.dataset.oaTarget.split(";"):[]);return 1<a.length&&a.every(e=>!(t.target=document.querySelector(e))),t.target||(t.target=document.querySelector(e.dataset.oaTarget)||e.closest("[data-oa-main]")||MAIN),t.history=!!e.hasAttribute("data-oa-history")||t.target===MAIN,t.scroll=!!e.hasAttribute("data-oa-scroll")&&(e.dataset.oaScroll?document.querySelector(e.dataset.oaScroll):t.target),t.scroll||t.target!==MAIN||(t.scroll=t.target),parseInt(e.dataset.oaTimeout)&&(t.timeout=parseInt(e.dataset.oaTimeout)),"FORM"===e.nodeName&&(t.method=(e.getAttribute("method")||"GET").toUpperCase()),"FORM"===e.nodeName&&(t.form=e,t.oaResetOnCancel=e.hasAttribute("data-oa-reset-on-cancel"),"GET"!==t.method&&(t.data=new FormData(e))),t},doAjax:(e,r)=>{if(ODEAJAX.performing)return!1;if((r={...ODEAJAX.baseoptions,...r}).confirm&&!confirm(r.confirm))return r.oaResetOnCancel&&r.form.reset(),!1;if(r.before&&"function"==typeof window[r.before]&&!window[r.before]())return!1;var o=!1;r.data&&"GET"===r.method&&(e+=(-1<e.indexOf("?")?"&":"?")+new URLSearchParams(r.data).toString(),r.data=!1),e=new URL(e,window.location.href).href,r.history&&e!==window.location.href&&(history.pushState({href:e},"",e),o=!0);const t=new Headers,a=(t.append("X-Requested-With","XMLHttpRequest"),r.enctype&&t.append("Content-Type",r.enctype),{});a.method=r.method,a.headers=t,"GET"!==r.method&&r.data&&(a.body=r.data),r.timeout&&(a.signal=AbortSignal.timeout(r.timeout)),ODEAJAX.performing=!0,fetch(e,a).then(async e=>{if(ODEAJAX.performing=!1,e.ok){r.history&&e.url!==window.location.href&&(o?history.replaceState({href:e.url},"",e.url):history.pushState({href:e.url},"",e.url));const a=e.headers.get("content-type");var t;a&&a.includes("application/json")?(t=await e.json(),ODEAJAX.showResponse(t,r),"function"==typeof window[r.callback]&&window[r.callback](e,r),!0===r.scroll&&(r.scroll=r.target),r.scroll&&r.scroll.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):ODEAJAX.showError(await e.text(),r)}else ODEAJAX.showError(await e.text(),r)}).catch(e=>{ODEAJAX.performing=!1,ODEAJAX.showError(e,r)})},doForm:e=>{e.preventDefault(),e.submitter&&e.submitter.hasAttribute("formaction")&&e.delegateTarget.setAttribute("action",e.submitter.formAction);var t=e.delegateTarget.getAttribute("action"),a="GET"===e.delegateTarget.getAttribute("method").toUpperCase(),t=t||(a?window.location.protocol+"//"+window.location.host+window.location.pathname:window.location.href);a&&(t+=(-1<t.indexOf("?")?"&":"?")+new URLSearchParams(new FormData(e.delegateTarget)).toString()),ODEAJAX.doAjax(t,ODEAJAX.readOptions(e.delegateTarget))},showAlerts:e=>{Array.from(e).forEach(e=>vNotify[e.function](e))},showResponse:(e,t)=>{var a,r;e.success&&e.html&&(a=(new DOMParser).parseFromString(e.html,"text/html"),t.target.id&&(r=a.getElementById(t.target.id))&&(e.html=r.innerHTML,a=r),t.append?(t.target.scrollIntoView({block:"end",inline:"end"}),t.target.insertAdjacentHTML("beforeend",e.html)):t.prepend?(t.target.scrollIntoView({block:"start",inline:"start"}),t.target.insertAdjacentHTML("afterbegin",e.html)):t.target.innerHTML=e.html,a.querySelectorAll("script").forEach(e=>{if(e.src)loadJS(e.src,null,t.target);else try{(0,eval)(e.innerText)}catch(e){}}),t.history&&(document.title=e.title||a.title)),e.alerts&&ODEAJAX.showAlerts(e.alerts)},showError:(e,t)=>{t.target.innerHTML=e||"Timeout"}};history.replaceState({href:window.location.href},null,window.location.href),document.addEventListener("DOMContentLoaded",e=>{window.addEventListener("popstate",e=>{if(window.location.hash)return!1;ODEAJAX.doAjax(e.state.href,{history:!1})}),document.querySelector("body").addEventListener("click",e=>{var t,e=e.target.closest("[data-close]");e&&((t=e.closest("[data-closable]"))?t.innerHTML="":e.dataset.close&&ODEAJAX.doAjax(e.dataset.close))}),document.querySelector("body").addEventListener("click",e=>{if(0<e.button||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)return!0;var t=e.target.closest("a[data-oa]");t&&(e.preventDefault(),ODEAJAX.doAjax(t.href,ODEAJAX.readOptions(t)))}),document.querySelector("body").addEventListener("click",e=>{var t=e.target.closest("a[data-oa-submit]");t&&(e.delegateTarget=t.dataset.oaSubmit?document.querySelector(t.dataset.oaSubmit):t.closest("form"),ODEAJAX.doForm(e))}),document.querySelector("body").addEventListener("submit",e=>{e.target.hasAttribute("data-oa")&&(e.delegateTarget=e.target,ODEAJAX.doForm(e))}),document.querySelector("body").addEventListener("change",e=>{e.target.hasAttribute("data-oa-submit")&&(e.delegateTarget=e.target.form,ODEAJAX.doForm(e))})});