/**
 * @file AJAX requests
 * @copyleft Oleksa Vyshnivsky <dying.escape@gmail.com> 2022
 * @license The MIT License (MIT)
 * */
var loadJS=function(t,e,a){var o=document.createElement("script");o.src=t,o.onload=e,o.onreadystatechange=e,a.appendChild(o)};const MAIN=document.querySelector("#main")||document.querySelector("main")||document.querySelector("body"),ODEAJAX={performing:!1,baseoptions:{append:!1,before:!1,callback:!1,confirm:!1,data:!1,history:!1,method:"GET",prepend:!1,scroll:MAIN,target:MAIN,timeout:3e4},readOptions:t=>{var e={},a=(e.append=t.hasAttribute("data-oa-append"),e.prepend=t.hasAttribute("data-oa-prepend"),e.before=t.dataset.oaBefore,e.callback=t.dataset.oaCallback,e.confirm=t.dataset.oaConfirm,t.dataset.oaTarget?t.dataset.oaTarget.split(";"):[]);return 1<a.length&&a.every(t=>!(e.target=document.querySelector(t))),e.target||(e.target=document.querySelector(t.dataset.oaTarget)||t.closest("[data-oa-main]")||MAIN),e.history=t.hasAttribute("data-oa-history")?!!t.dataset.oaHistory:e.target===MAIN,e.scroll=!!t.hasAttribute("data-oa-scroll")&&(t.dataset.oaScroll?document.querySelector(t.dataset.oaScroll):e.target),e.scroll||e.target!==MAIN||(e.scroll=e.target),parseInt(t.dataset.oaTimeout)&&(e.timeout=parseInt(t.dataset.oaTimeout)),"FORM"===t.nodeName&&(e.method=(t.getAttribute("method")||"GET").toUpperCase()),e.url="FORM"===t.nodeName?t.getAttribute("action"):t.href,"FORM"!==t.nodeName||e.url||(e.url="POST"===e.method?window.location.href:window.location.protocol+"//"+window.location.host+window.location.pathname),"FORM"===t.nodeName&&(e.form=t,e.oaResetOnCancel=t.hasAttribute("data-oa-reset-on-cancel"),e.data=new FormData(t),e.data&&"GET"===e.method&&(e.url+=(-1<e.url.indexOf("?")?"&":"?")+new URLSearchParams(e.data).toString(),e.data=!1)),e},doActualAjax:r=>new Promise((t,e)=>{var a=!(ODEAJAX.performing=!0),o=(r.history&&r.url!==window.location.href&&(history.pushState({href:r.url},"",r.url),a=!0),new XMLHttpRequest);o.open(r.method,r.url),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.timeout=r.timeout,r.enctype&&o.setRequestHeader("Content-Type",r.enctype),o.onload=function(){if(ODEAJAX.performing=!1,200===o.status){r.history&&o.responseURL!==window.location.href&&(a?history.replaceState({href:o.responseURL},"",o.responseURL):history.pushState({href:o.responseURL},"",o.responseURL));try{t(JSON.parse(o.response))}catch(t){e(o)}}else e(o)},o.ontimeout=t=>{ODEAJAX.performing=!1,e(o)},o.send(r.data)}),doAjax:e=>(e={...ODEAJAX.baseoptions,...e}).confirm&&!confirm(e.confirm)?(e.oaResetOnCancel&&e.form.reset(),!1):!(e.before&&"function"==typeof window[e.before]&&!window[e.before]())&&void ODEAJAX.doActualAjax(e).then(t=>{ODEAJAX.showResponse(t,e),"function"==typeof window[e.callback]&&window[e.callback](t,e),!0===e.scroll&&(e.scroll=e.target),e.scroll&&e.scroll.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}).catch(t=>{ODEAJAX.showError(t,e)}),doForm:t=>{if(t.preventDefault(),ODEAJAX.performing)return!1;t.submitter&&t.submitter.hasAttribute("formaction")&&t.delegateTarget.setAttribute("action",t.submitter.formAction),ODEAJAX.doAjax(ODEAJAX.readOptions(t.delegateTarget))},showAlerts:t=>{Array.from(t).forEach(t=>{t.position||(t.position=vNotify.positionOption.bottomRight),t.fadeInDuration||(t.fadeInDuration=10),vNotify[t.function](t)})},showResponse:(t,e)=>{var a,o;t.success&&t.html&&(a=(new DOMParser).parseFromString(t.html,"text/html"),!e.target.id||(o=a.getElementById(e.target.id))&&(t.html=o.innerHTML,a=o),e.append?(e.target.scrollIntoView({block:"end",inline:"end"}),e.target.insertAdjacentHTML("beforeend",t.html)):e.prepend?(e.target.scrollIntoView({block:"start",inline:"start"}),e.target.insertAdjacentHTML("afterbegin",t.html)):e.target.innerHTML=t.html,a.querySelectorAll("script").forEach(t=>{if(t.src)loadJS(t.src,null,e.target);else try{(0,eval)(t.innerText)}catch(t){}}),e.history&&(document.title=t.title||a.title)),t.alerts&&ODEAJAX.showAlerts(t.alerts)},showError:(t,e)=>{ODEAJAX.showAlerts([{function:"error",text:t.responseText||t.statusText||"Timeout",title:""}])}};history.replaceState({href:window.location.href},null,window.location.href),document.addEventListener("DOMContentLoaded",t=>{window.addEventListener("popstate",t=>!window.location.hash&&void ODEAJAX.doAjax({history:!1,url:t.state.href})),document.addEventListener("click",a=>{(a.path||a.composedPath&&a.composedPath()).every(t=>{return"BODY"!==t.nodeName&&"HTML"!==t.nodeName&&(t.hasAttribute("data-close")?((e=t.closest("[data-closable]"))?e.innerHTML="":t.dataset.close&&ODEAJAX.doAjax({url:t.dataset.close,history:!0}),!1):"A"===t.nodeName&&t.hasAttribute("data-oa")?!!(0<a.button||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey)||(a.preventDefault(),a.delegateTarget=t,ODEAJAX.performing||ODEAJAX.doAjax(ODEAJAX.readOptions(a.delegateTarget)),!1):"A"!==t.nodeName||!t.hasAttribute("data-oa-submit")||(a.delegateTarget=t.dataset.oaSubmit?document.querySelector(t.dataset.oaSubmit):t.closest("form"),ODEAJAX.doForm(a),!1));var e})}),document.addEventListener("submit",t=>{t.target.hasAttribute("data-oa")&&(t.delegateTarget=t.target,ODEAJAX.doForm(t))}),document.addEventListener("change",t=>{t.target.hasAttribute("data-oa-submit")&&(t.delegateTarget=t.target.form,ODEAJAX.doForm(t))})});