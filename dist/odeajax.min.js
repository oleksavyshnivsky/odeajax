/**
 * @file AJAX requests
 * @copyleft Oleksa Vyshnivsky <dying.escape@gmail.com> 2022
 * @license The MIT License (MIT)
 * */
var loadJS=function(e,t,a){var o=document.createElement("script");o.src=e,o.onload=t,o.onreadystatechange=t,a.appendChild(o)};const MAIN=document.querySelector("#main")||document.querySelector("main")||document.querySelector("body"),ODEAJAX={performing:!1,baseoptions:{append:!1,before:!1,callback:!1,confirm:!1,data:!1,history:!1,method:"GET",prepend:!1,scroll:MAIN,target:MAIN,timeout:3e4},readOptions:e=>{var t={},a=(t.append=e.hasAttribute("data-oa-append"),t.prepend=e.hasAttribute("data-oa-prepend"),t.before=e.dataset.oaBefore,t.callback=e.dataset.oaCallback,t.confirm=e.dataset.oaConfirm,e.dataset.oaTarget?e.dataset.oaTarget.split(";"):[]);return 1<a.length&&a.every(e=>!(t.target=document.querySelector(e))),t.target||(t.target=document.querySelector(e.dataset.oaTarget)||e.closest("[data-oa-main]")||MAIN),t.history=!!e.hasAttribute("data-oa-history")||t.target===MAIN,t.scroll=!!e.hasAttribute("data-oa-scroll")&&(e.dataset.oaScroll?document.querySelector(e.dataset.oaScroll):t.target),t.scroll||t.target!==MAIN||(t.scroll=t.target),parseInt(e.dataset.oaTimeout)&&(t.timeout=parseInt(e.dataset.oaTimeout)),"FORM"===e.nodeName&&(t.method=(e.getAttribute("method")||"GET").toUpperCase()),t.url="FORM"===e.nodeName?e.getAttribute("action"):e.href,"FORM"!==e.nodeName||t.url||(t.url="POST"===t.method?window.location.href:window.location.protocol+"//"+window.location.host+window.location.pathname),"FORM"===e.nodeName&&(t.form=e,t.oaResetOnCancel=e.hasAttribute("data-oa-reset-on-cancel"),t.data=new FormData(e),t.data&&"GET"===t.method&&(t.url+=(-1<t.url.indexOf("?")?"&":"?")+new URLSearchParams(t.data).toString(),t.data=!1)),t},doActualAjax:r=>new Promise((e,t)=>{var a=!(ODEAJAX.performing=!0),o=(r.history&&r.url!==window.location.href&&(history.pushState({href:r.url},"",r.url),a=!0),new XMLHttpRequest);o.open(r.method,r.url),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.timeout=r.timeout,r.enctype&&o.setRequestHeader("Content-Type",r.enctype),o.onload=function(){if(ODEAJAX.performing=!1,200===o.status){r.history&&o.responseURL!==window.location.href&&(a?history.replaceState({href:o.responseURL},"",o.responseURL):history.pushState({href:o.responseURL},"",o.responseURL));try{e(JSON.parse(o.response))}catch(e){t(o)}}else t(o)},o.ontimeout=e=>{ODEAJAX.performing=!1,t(o)},o.send(r.data)}),doAjax:t=>(t={...ODEAJAX.baseoptions,...t}).confirm&&!confirm(t.confirm)?(t.oaResetOnCancel&&t.form.reset(),!1):!(t.before&&"function"==typeof window[t.before]&&!window[t.before]())&&void ODEAJAX.doActualAjax(t).then(e=>{ODEAJAX.showResponse(e,t),"function"==typeof window[t.callback]&&window[t.callback](e,t),!0===t.scroll&&(t.scroll=t.target),t.scroll&&t.scroll.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})}).catch(e=>{ODEAJAX.showError(e,t)}),doForm:e=>{if(e.preventDefault(),ODEAJAX.performing)return!1;e.submitter&&e.submitter.hasAttribute("formaction")&&e.delegateTarget.setAttribute("action",e.submitter.formAction),ODEAJAX.doAjax(ODEAJAX.readOptions(e.delegateTarget))},showAlerts:e=>{Array.from(e).forEach(e=>{e.position||(e.position=vNotify.positionOption.bottomRight),e.fadeInDuration||(e.fadeInDuration=10),vNotify[e.function](e)})},showResponse:(e,t)=>{var a,o;e.success&&e.html&&(a=(new DOMParser).parseFromString(e.html,"text/html"),!t.target.id||(o=a.getElementById(t.target.id))&&(e.html=o.innerHTML,a=o),t.append?(t.target.scrollIntoView({block:"end",inline:"end"}),t.target.insertAdjacentHTML("beforeend",e.html)):t.prepend?(t.target.scrollIntoView({block:"start",inline:"start"}),t.target.insertAdjacentHTML("afterbegin",e.html)):t.target.innerHTML=e.html,a.querySelectorAll("script").forEach(e=>{if(e.src)loadJS(e.src,null,t.target);else try{(0,eval)(e.innerText)}catch(e){}}),t.history&&(document.title=e.title||a.title)),e.alerts&&ODEAJAX.showAlerts(e.alerts)},showError:(e,t)=>{ODEAJAX.showAlerts([{function:"error",text:e.responseText||e.statusText||"Timeout",title:""}])}};history.replaceState({href:window.location.href},null,window.location.href),document.addEventListener("DOMContentLoaded",e=>{window.addEventListener("popstate",e=>!window.location.hash&&void ODEAJAX.doAjax({history:!1,url:e.state.href})),document.addEventListener("click",a=>{(a.path||a.composedPath&&a.composedPath()).every(e=>{return"BODY"!==e.nodeName&&"HTML"!==e.nodeName&&(e.hasAttribute("data-close")?((t=e.closest("[data-closable]"))?t.innerHTML="":e.dataset.close&&ODEAJAX.doAjax({url:e.dataset.close,history:!0}),!1):"A"===e.nodeName&&e.hasAttribute("data-oa")?!!(0<a.button||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey)||(a.preventDefault(),a.delegateTarget=e,ODEAJAX.performing||ODEAJAX.doAjax(ODEAJAX.readOptions(a.delegateTarget)),!1):"A"!==e.nodeName||!e.hasAttribute("data-oa-submit")||(a.delegateTarget=e.dataset.oaSubmit?document.querySelector(e.dataset.oaSubmit):e.closest("form"),ODEAJAX.doForm(a),!1));var t})}),document.addEventListener("submit",e=>{e.target.hasAttribute("data-oa")&&(e.delegateTarget=e.target,ODEAJAX.doForm(e))}),document.addEventListener("change",e=>{e.target.hasAttribute("data-oa-submit")&&(e.delegateTarget=e.target.form,ODEAJAX.doForm(e))})});