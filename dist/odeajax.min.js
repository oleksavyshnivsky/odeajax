/**
 * @file AJAX requests
 * @copyleft Oleksa Vyshnivsky <dying.escape@gmail.com> 2022
 * @license The MIT License (MIT)
 * @version 1.0.4
 * */
var loadJS=function(t,e,a){var o=document.createElement("script");o.src=t,o.onload=e,o.onreadystatechange=e,a.appendChild(o)};const MAIN=document.querySelector("#main")||document.querySelector("main")||document.querySelector("body"),ODEAJAX={performing:!1,baseoptions:{append:!1,before:!1,callback:!1,confirm:!1,data:!1,history:!1,method:"GET",prepend:!1,scroll:MAIN,target:MAIN,timeout:3e4},readOptions:t=>{var e={},a=(e.append=t.hasAttribute("data-oa-append"),e.prepend=t.hasAttribute("data-oa-prepend"),e.before=t.dataset.oaBefore,e.callback=t.dataset.oaCallback,e.confirm=t.dataset.oaConfirm,t.dataset.oaTarget?t.dataset.oaTarget.split(";"):[]);return 1<a.length&&a.every(t=>!(e.target=document.querySelector(t))),e.target||(e.target=document.querySelector(t.dataset.oaTarget)||t.closest("[data-oa-main]")||MAIN),e.history=!!t.hasAttribute("data-oa-history")||e.target===MAIN,e.scroll=!!t.hasAttribute("data-oa-scroll")&&(t.dataset.oaScroll?document.querySelector(t.dataset.oaScroll):e.target),e.scroll||e.target!==MAIN||(e.scroll=e.target),parseInt(t.dataset.oaTimeout)&&(e.timeout=parseInt(t.dataset.oaTimeout)),"FORM"===t.nodeName&&(e.method=(t.getAttribute("method")||"GET").toUpperCase()),"FORM"===t.nodeName&&(e.form=t,e.oaResetOnCancel=t.hasAttribute("data-oa-reset-on-cancel"),"GET"!==e.method&&(e.data=new FormData(t))),e},doAjax:(t,o)=>{if(ODEAJAX.performing)return!1;if((o={...ODEAJAX.baseoptions,...o}).confirm&&!confirm(o.confirm))return o.oaResetOnCancel&&o.form.reset(),!1;if(o.before&&"function"==typeof window[o.before]&&!window[o.before]())return!1;var r=!1;t=new URL(t,window.location.href).href,o.history&&t!==window.location.href&&(history.pushState({href:t},"",t),r=!0);const e=new Headers,a=(e.append("X-Requested-With","XMLHttpRequest"),o.enctype&&e.append("Content-Type",o.enctype),{});a.method=o.method,a.headers=e,"GET"!==o.method&&o.data&&(a.body=o.data),o.timeout&&(a.signal=AbortSignal.timeout(o.timeout)),ODEAJAX.performing=!0,fetch(t,a).then(async t=>{if(ODEAJAX.performing=!1,t.ok){o.history&&t.url!==window.location.href&&(r?history.replaceState({href:t.url},"",t.url):history.pushState({href:t.url},"",t.url));const a=t.headers.get("content-type");var e;a&&a.includes("application/json")?(e=await t.json(),ODEAJAX.showResponse(e,o),"function"==typeof window[o.callback]&&window[o.callback](t,o),!0===o.scroll&&(o.scroll=o.target),o.scroll&&o.scroll.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):ODEAJAX.showError(await t.text(),o)}else ODEAJAX.showError(await t.text(),o)}).catch(t=>{ODEAJAX.performing=!1,ODEAJAX.showError(t,o)})},submit:t=>{var e=t.getAttribute("action"),a="GET"===t.getAttribute("method").toUpperCase(),e=e||(a?window.location.protocol+"//"+window.location.host+window.location.pathname:window.location.href);a&&(e+=(-1<e.indexOf("?")?"&":"?")+new URLSearchParams(new FormData(t)).toString()),ODEAJAX.doAjax(e,ODEAJAX.readOptions(t))},showAlerts:t=>{Array.from(t).forEach(t=>vNotify[t.function](t))},showResponse:(t,e)=>{var a,o;t.success&&t.html&&(a=(new DOMParser).parseFromString(t.html,"text/html"),e.target.id&&(o=a.getElementById(e.target.id))&&(t.html=o.innerHTML,a=o),e.append?(e.target.scrollIntoView({block:"end",inline:"end"}),e.target.insertAdjacentHTML("beforeend",t.html)):e.prepend?(e.target.scrollIntoView({block:"start",inline:"start"}),e.target.insertAdjacentHTML("afterbegin",t.html)):e.target.innerHTML=t.html,a.querySelectorAll("script").forEach(t=>{if(t.src)loadJS(t.src,null,e.target);else try{(0,eval)(t.innerText)}catch(t){}}),e.history&&(document.title=t.title||a.title)),t.alerts&&ODEAJAX.showAlerts(t.alerts)},showError:(t,e)=>{e.target.innerHTML=t||"Timeout"}};history.replaceState({href:window.location.href},null,window.location.href),document.addEventListener("DOMContentLoaded",t=>{window.addEventListener("popstate",t=>{if(window.location.hash)return!1;ODEAJAX.doAjax(t.state.href,{history:!1})}),document.querySelector("body").addEventListener("click",t=>{var e,t=t.target.closest("[data-close]");t&&((e=t.closest("[data-closable]"))?e.innerHTML="":t.dataset.close&&ODEAJAX.doAjax(t.dataset.close))}),document.querySelector("body").addEventListener("click",t=>{if(0<t.button||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey)return!0;var e=t.target.closest("a[data-oa]");e&&(t.preventDefault(),ODEAJAX.doAjax(e.href,ODEAJAX.readOptions(e)))}),document.querySelector("body").addEventListener("click",t=>{var t=t.target.closest("a[data-oa-submit]");t&&(t=t.dataset.oaSubmit?document.querySelector(t.dataset.oaSubmit):t.closest("form"),ODEAJAX.submit(t))}),document.querySelector("body").addEventListener("submit",t=>{t.target.hasAttribute("data-oa")&&(t.preventDefault(),t.submitter&&t.submitter.hasAttribute("formaction")&&t.target.setAttribute("action",t.submitter.formAction),ODEAJAX.submit(t.target))}),document.querySelector("body").addEventListener("change",t=>{t.target.hasAttribute("data-oa-submit")&&ODEAJAX.submit(t.target.form)})});